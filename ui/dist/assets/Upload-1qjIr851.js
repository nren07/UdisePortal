import{r as s,e as S,a as p,b as y,c as N,d as w,f as D,j as e}from"./index-CxiSGgYB.js";const I=({handleClose:f})=>{const[o,n]=s.useState({jobType:"",file:null,jobTitle:""}),[i,u]=s.useState({TitleError:"",optionError:"",fileError:""}),[b,m]=s.useState(!1),T=S(),c=p(y),d=p(N),h=p(w),j=l=>["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type)?l.size>5242880?"File size exceeds 5MB.":"":"Invalid file type. Only .xlsx files are allowed.",E=()=>o.file&&o.jobTitle&&o.jobType,x=s.useCallback(async l=>{if(E()){m(!0);const t=new FormData;t.append("jobType",o.jobType),t.append("file",o.file),t.append("jobTitle",o.jobTitle);try{const r=await fetch(`http://udise.pytosoft.com/v1/fileupload/${c}/upload`,{method:"POST",body:t,headers:{Authorization:`Bearer ${d}`},signal:l});if(!r.ok)throw new Error("Failed to upload");n({jobType:"",file:null,jobTitle:""}),console.log(await r.json())}catch(r){r.name==="AbortError"?console.log("Request aborted"):(console.error("Error uploading file:",r),alert("An error occurred while uploading the file"))}finally{m(!1)}}},[o,c,d]),v=l=>{l.preventDefault();const t={TitleError:"",optionError:"",fileError:""};let r=!1;if(o.jobTitle||(t.TitleError="Please provide a job title",r=!0),o.jobType||(t.optionError="Please select a job type",r=!0),!o.file)t.fileError="Please choose a file",r=!0;else{const a=j(o.file);a&&(t.fileError=a,r=!0)}if(u(t),!r){const a=new AbortController;return x(a.signal),()=>a.abort()}};return s.useEffect(()=>{(Date.now()>=h||!d||!c)&&T(D())},[T,h,d,c]),s.useEffect(()=>{u({TitleError:"",optionError:"",fileError:""})},[o]),e.jsx("div",{className:"modal-overlay",onClick:f,children:e.jsx("div",{className:"modal-content",onClick:l=>l.stopPropagation(),children:e.jsxs("form",{onSubmit:v,className:"p-4 shadow rounded bg-white",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"jobTitle",className:"form-label",children:"Job Title"}),e.jsx("button",{className:"close-btn",onClick:f,children:"X"})," ",e.jsx("input",{id:"jobTitle",type:"text",className:`form-control ${i.TitleError&&"is-invalid"}`,value:o.jobTitle,onChange:l=>n({...o,jobTitle:l.target.value})}),i.TitleError&&e.jsx("div",{className:"invalid-feedback",children:i.TitleError})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"dropdown",className:"form-label",children:"Job Type"}),e.jsxs("select",{id:"dropdown",className:`form-select ${i.optionError&&"is-invalid"}`,value:o.jobType,onChange:l=>n({...o,jobType:l.target.value}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select an option"}),e.jsx("option",{value:"PROGRESSION_ACTIVITY",children:"PROGRESSION_ACTIVITY"}),e.jsx("option",{value:"ADD_NEW_STUDENTS",children:"ADD_NEW_STUDENTS"}),e.jsx("option",{value:"UPDATE_STUDENTS",children:"UPDATE_STUDENTS"})]}),i.optionError&&e.jsx("div",{className:"invalid-feedback",children:i.optionError})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"fileInput",className:"form-label",children:"Choose File"}),e.jsx("input",{id:"fileInput",type:"file",className:`form-control ${i.fileError&&"is-invalid"}`,onChange:l=>n({...o,file:l.target.files[0]})}),i.fileError&&e.jsx("div",{className:"invalid-feedback",children:i.fileError})]}),e.jsx("a",{href:"samplefile.xlsx",download:"sample_file.xlsx",children:e.jsx("button",{type:"button",className:"btn btn-secondary w-100 mb-3",children:"Download Sample File"})}),e.jsx("button",{type:"submit",className:"btn btn-success w-100",disabled:b,children:b?"Uploading...":"Submit"})]})})})};export{I as default};
